<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{-webkit-tap-highlight-color:transparent;-webkit-appearance:none;appearance:none;background-color:initial;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTAgMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJtMzIgOTAgNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTQwIDcwSDIwVjUwbTIwIDBMMjAgNzBtNDAtNDBoMjB2MjBtLTIwIDAgMjAtMjAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwIDUwaDIwdjIwbS0yMCAwIDIwLTIwbTQwIDBINjBWMzBtMjAgMEw2MCA1MCIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNODcuOCA0Ny41Qzg5IDUwIDg3LjcgNTIgODUgNTJIMzVhOC43IDguNyAwIDAgMS03LjItNC41bC0xNS42LTMxQzExIDE0IDEyLjIgMTIgMTUgMTJoNTBhOC44IDguOCAwIDAgMSA3LjIgNC41ek02MCA1MnYzNm0tMTAgMGgyME00NSA0MmgyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iNSIvPjwvc3ZnPg==") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-bigger{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMTIgNTBoODBNNTIgOTBWMTAiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjUiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-smaller{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMTIgNTBoODAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjUiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}}@keyframes __bespoke_marp_transition_reduced_outgoing__{0%{opacity:1}to{opacity:0}}@keyframes __bespoke_marp_transition_reduced_incoming__{0%{mix-blend-mode:plus-lighter;opacity:0}to{mix-blend-mode:plus-lighter;opacity:1}}.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{::view-transition-group(*){animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-timing-function:ease}::view-transition-new(*),::view-transition-old(*){animation-delay:0s;animation-direction:var(--marp-bespoke-transition-animation-direction,normal);animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-fill-mode:both;animation-name:var(--marp-bespoke-transition-animation-name,var(--marp-bespoke-transition-animation-name-fallback,__bespoke_marp_transition_no_animation__));mix-blend-mode:normal}::view-transition-old(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_outgoing__;animation-timing-function:ease}::view-transition-new(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_incoming__;animation-timing-function:ease}::view-transition-new(root),::view-transition-old(root){animation-timing-function:linear}::view-transition-new(__bespoke_marp_transition_osc__),::view-transition-old(__bespoke_marp_transition_osc__){animation-duration:0s!important;animation-name:__bespoke_marp_transition_osc__!important}::view-transition-new(__bespoke_marp_transition_osc__){opacity:0!important}.bespoke-marp-transition-warming-up::view-transition-group(*),.bespoke-marp-transition-warming-up::view-transition-new(*),.bespoke-marp-transition-warming-up::view-transition-old(*){animation-play-state:paused!important}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;opacity:0;pointer-events:none;z-index:-1}svg.bespoke-marp-slide:not(.bespoke-marp-active) *{view-transition-name:none!important}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;opacity:1;pointer-events:auto;z-index:0}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}}@media screen and (prefers-reduced-motion:reduce){svg.bespoke-marp-slide *{view-transition-name:none!important}}@media screen{[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{bottom:0;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{view-transition-name:__bespoke_marp_transition_osc__;background:#000000a6;border-radius:7px;bottom:50px;color:#fff;contain:paint;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;user-select:none;white-space:nowrap;will-change:transform;z-index:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{background:#0288d1;flex:0 0 0;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:#0000}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{display:grid;font-family:Helvetica,Arial,sans-serif;grid-template:"current dragbar next" minmax(140px,1fr) "current dragbar note" 2fr "info    dragbar note" 3em;grid-template-columns:minmax(3px,var(--bespoke-marp-presenter-split-ratio,66%)) 0 minmax(3px,1fr);height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container{background:#0288d1;cursor:col-resize;grid-area:dragbar;margin-left:-3px;opacity:0;position:relative;transition:opacity .4s linear .1s;width:6px;z-index:10}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container:hover{opacity:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container.active{opacity:1;transition-delay:0s}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:#0000;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note;position:relative;z-index:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper{bottom:0;display:block;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons{background:#000000a6;border-radius:4px;bottom:0;display:flex;gap:4px;margin:12px;opacity:0;padding:6px;pointer-events:none;position:absolute;right:0;transition:opacity .2s linear}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons:focus-within,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper:focus-within+.bespoke-marp-presenter-note-buttons,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container:hover .bespoke-marp-presenter-note-buttons{opacity:1;pointer-events:auto}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{word-wrap:break-word;box-sizing:border-box;font-size:calc(1.1em*var(--bespoke-marp-note-font-scale, 1));height:calc(100% - 40px);margin:20px;overflow:auto;padding-right:3px;scrollbar-color:#eeeeee80 #0000;scrollbar-width:thin;white-space:pre-wrap;width:calc(100% - 40px)}}@media screen{body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:#0000}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:#eeeeee80;border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;overflow:hidden;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{box-sizing:border-box;display:block;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer:hover{cursor:pointer}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>@charset "UTF-8";@import "https://fonts.bunny.net/css?family=Lato:400,900|Roboto+Mono:400,700&display=swap";div#p>svg>foreignObject>section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center}div#p>svg>foreignObject>section:after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#p>svg>foreignObject>section:not([data-marpit-pagination]):after{display:none}/* Normalization */div#p>svg>foreignObject>section :is(h1,marp-h1){font-size:2em;margin:0.67em 0}div#p>svg>foreignObject>section video::-webkit-media-controls{will-change:transform}@page{size:1280px 720px;margin:0}@media print{body,html{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#p>svg>foreignObject>section{page-break-before:always;break-before:page}div#p>svg>foreignObject>section,div#p>svg>foreignObject>section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;transition:none!important}div#p>svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}div#p>svg>foreignObject>section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}
/*!
 * Marp / Marpit Gaia theme.
 *
 * @theme gaia
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 16:9 1280px 720px
 * @size 4:3 960px 720px
 */div#p>svg>foreignObject>section :is(pre,marp-pre) code.hljs{display:block;overflow-x:auto;padding:1em}div#p>svg>foreignObject>section code.hljs{padding:3px 5px}div#p>svg>foreignObject>section .hljs{background:#000;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-comment,div#p>svg>foreignObject>section .hljs-quote{color:#aeaeae;font-style:italic}div#p>svg>foreignObject>section .hljs-keyword,div#p>svg>foreignObject>section .hljs-selector-tag,div#p>svg>foreignObject>section .hljs-type{color:#e28964}div#p>svg>foreignObject>section .hljs-string{color:#65b042}div#p>svg>foreignObject>section .hljs-subst{color:#daefa3}div#p>svg>foreignObject>section .hljs-link,div#p>svg>foreignObject>section .hljs-regexp{color:#e9c062}div#p>svg>foreignObject>section .hljs-name,div#p>svg>foreignObject>section .hljs-section,div#p>svg>foreignObject>section .hljs-tag,div#p>svg>foreignObject>section .hljs-title{color:#89bdff}div#p>svg>foreignObject>section .hljs-class .hljs-title,div#p>svg>foreignObject>section .hljs-doctag,div#p>svg>foreignObject>section .hljs-title.class_{text-decoration:underline}div#p>svg>foreignObject>section .hljs-bullet,div#p>svg>foreignObject>section .hljs-number,div#p>svg>foreignObject>section .hljs-symbol{color:#3387cc}div#p>svg>foreignObject>section .hljs-params,div#p>svg>foreignObject>section .hljs-template-variable,div#p>svg>foreignObject>section .hljs-variable{color:#3e87e3}div#p>svg>foreignObject>section .hljs-attribute{color:#cda869}div#p>svg>foreignObject>section .hljs-meta{color:#8996a8}div#p>svg>foreignObject>section .hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}div#p>svg>foreignObject>section .hljs-addition{background-color:#253b22;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-deletion{background-color:#420e09;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-selector-class{color:#9b703f}div#p>svg>foreignObject>section .hljs-selector-id{color:#8b98ab}div#p>svg>foreignObject>section .hljs-emphasis{font-style:italic}div#p>svg>foreignObject>section .hljs-strong{font-weight:700}div#p>svg>foreignObject>section :is(h1,marp-h1),div#p>svg>foreignObject>section :is(h2,marp-h2),div#p>svg>foreignObject>section :is(h3,marp-h3),div#p>svg>foreignObject>section :is(h4,marp-h4),div#p>svg>foreignObject>section :is(h5,marp-h5),div#p>svg>foreignObject>section :is(h6,marp-h6){margin:.5em 0 0}div#p>svg>foreignObject>section :is(h1,marp-h1) strong,div#p>svg>foreignObject>section :is(h2,marp-h2) strong,div#p>svg>foreignObject>section :is(h3,marp-h3) strong,div#p>svg>foreignObject>section :is(h4,marp-h4) strong,div#p>svg>foreignObject>section :is(h5,marp-h5) strong,div#p>svg>foreignObject>section :is(h6,marp-h6) strong{font-weight:inherit}div#p>svg>foreignObject>section :is(h1,marp-h1)::part(auto-scaling),div#p>svg>foreignObject>section :is(h2,marp-h2)::part(auto-scaling),div#p>svg>foreignObject>section :is(h3,marp-h3)::part(auto-scaling),div#p>svg>foreignObject>section :is(h4,marp-h4)::part(auto-scaling),div#p>svg>foreignObject>section :is(h5,marp-h5)::part(auto-scaling),div#p>svg>foreignObject>section :is(h6,marp-h6)::part(auto-scaling){max-height:580px}div#p>svg>foreignObject>section :is(h1,marp-h1){font-size:1.8em}div#p>svg>foreignObject>section :is(h2,marp-h2){font-size:1.5em}div#p>svg>foreignObject>section :is(h3,marp-h3){font-size:1.3em}div#p>svg>foreignObject>section :is(h4,marp-h4){font-size:1.1em}div#p>svg>foreignObject>section :is(h5,marp-h5){font-size:1em}div#p>svg>foreignObject>section :is(h6,marp-h6){font-size:.9em}div#p>svg>foreignObject>section blockquote,div#p>svg>foreignObject>section p{margin:1em 0 0}div#p>svg>foreignObject>section ol>li,div#p>svg>foreignObject>section ul>li{margin:.3em 0 0}div#p>svg>foreignObject>section ol>li>p,div#p>svg>foreignObject>section ul>li>p{margin:.6em 0 0}div#p>svg>foreignObject>section code{display:inline-block;font-family:Roboto Mono,monospace;font-size:.8em;letter-spacing:0;margin:-.1em .15em;padding:.1em .2em;vertical-align:baseline}div#p>svg>foreignObject>section :is(pre,marp-pre){display:block;margin:1em 0 0;overflow:visible}div#p>svg>foreignObject>section :is(pre,marp-pre) code{box-sizing:border-box;font-size:.7em;margin:0;min-width:100%;padding:.5em}div#p>svg>foreignObject>section :is(pre,marp-pre)::part(auto-scaling){max-height:calc(580px - 1em)}div#p>svg>foreignObject>section blockquote{margin:1em 0 0;padding:0 1em;position:relative}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before{content:"“";display:block;font-family:Times New Roman,serif;font-weight:700;position:absolute}div#p>svg>foreignObject>section blockquote:before{left:0;top:0}div#p>svg>foreignObject>section blockquote:after{bottom:0;right:0;transform:rotate(180deg)}div#p>svg>foreignObject>section blockquote>:first-child{margin-top:0}div#p>svg>foreignObject>section mark{background:transparent}div#p>svg>foreignObject>section table{border-collapse:collapse;border-spacing:0;margin:1em 0 0}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{border-style:solid;border-width:1px;padding:.2em .4em}div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header,div#p>svg>foreignObject>section:after{box-sizing:border-box;font-size:66%;height:70px;line-height:50px;overflow:hidden;padding:10px 25px;position:absolute}div#p>svg>foreignObject>section:after{--marpit-root-font-size:66%}div#p>svg>foreignObject>section header{top:0}div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{left:0;right:0}div#p>svg>foreignObject>section footer{bottom:0}div#p>svg>foreignObject>section{word-wrap:break-word;--color-background:#fff8e1;--color-background-stripe:rgba(69,90,100,.1);--color-foreground:#455a64;--color-dimmed:#6a7a7d;--color-highlight:#0288d1;background-color:var(--color-background);background-image:linear-gradient(135deg,hsla(0,0%,53%,0),hsla(0,0%,53%,.02) 50%,hsla(0,0%,100%,0) 0,hsla(0,0%,100%,.05));color:var(--color-foreground);font-family:Lato,Avenir Next,Avenir,Trebuchet MS,Segoe UI,sans-serif;font-size:35px;height:720px;letter-spacing:1.25px;line-height:1.35;padding:70px;width:1280px}div#p>svg>foreignObject>section{--marpit-root-font-size:35px}div#p>svg>foreignObject>section:after{bottom:0;font-size:80%;right:0}div#p>svg>foreignObject>section:after{--marpit-root-font-size:80%}div#p>svg>foreignObject>section a,div#p>svg>foreignObject>section mark{color:var(--color-highlight)}div#p>svg>foreignObject>section code{background:var(--color-dimmed);color:var(--color-background)}div#p>svg>foreignObject>section :is(h1,marp-h1) strong,div#p>svg>foreignObject>section :is(h2,marp-h2) strong,div#p>svg>foreignObject>section :is(h3,marp-h3) strong,div#p>svg>foreignObject>section :is(h4,marp-h4) strong,div#p>svg>foreignObject>section :is(h5,marp-h5) strong,div#p>svg>foreignObject>section :is(h6,marp-h6) strong{color:var(--color-highlight)}div#p>svg>foreignObject>section :is(pre,marp-pre){background:var(--color-foreground)}div#p>svg>foreignObject>section :is(pre,marp-pre)>code{background:transparent}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before,div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header,div#p>svg>foreignObject>section section:after{color:var(--color-dimmed)}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{border-color:var(--color-foreground)}div#p>svg>foreignObject>section table thead th{background:var(--color-foreground);color:var(--color-background)}div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) th{background:var(--color-background-stripe,transparent)}div#p>svg>foreignObject>section>:first-child,div#p>svg>foreignObject>section>header:first-child+*{margin-top:0}div#p>svg>foreignObject>section:where(.invert){--color-background:#455a64;--color-background-stripe:rgba(255,248,225,.1);--color-foreground:#fff8e1;--color-dimmed:#dad8c8;--color-highlight:#81d4fa}div#p>svg>foreignObject>section:where(.gaia){--color-background:#0288d1;--color-background-stripe:rgba(255,248,225,.1);--color-foreground:#fff8e1;--color-dimmed:#cce2de;--color-highlight:#81d4fa}div#p>svg>foreignObject>section:where(.lead){display:flex;flex-flow:column nowrap;justify-content:center}div#p>svg>foreignObject>section:where(.lead) :is(h1,marp-h1),div#p>svg>foreignObject>section:where(.lead) :is(h2,marp-h2),div#p>svg>foreignObject>section:where(.lead) :is(h3,marp-h3),div#p>svg>foreignObject>section:where(.lead) :is(h4,marp-h4),div#p>svg>foreignObject>section:where(.lead) :is(h5,marp-h5),div#p>svg>foreignObject>section:where(.lead) :is(h6,marp-h6){text-align:center}div#p>svg>foreignObject>section:where(.lead) p{text-align:center}div#p>svg>foreignObject>section:where(.lead) blockquote>:is(h1,marp-h1),div#p>svg>foreignObject>section:where(.lead) blockquote>:is(h2,marp-h2),div#p>svg>foreignObject>section:where(.lead) blockquote>:is(h3,marp-h3),div#p>svg>foreignObject>section:where(.lead) blockquote>:is(h4,marp-h4),div#p>svg>foreignObject>section:where(.lead) blockquote>:is(h5,marp-h5),div#p>svg>foreignObject>section:where(.lead) blockquote>:is(h6,marp-h6),div#p>svg>foreignObject>section:where(.lead) blockquote>p{text-align:left}div#p>svg>foreignObject>section:where(.lead) ol>li>p,div#p>svg>foreignObject>section:where(.lead) ul>li>p{text-align:left}div#p>svg>foreignObject>section:where(.lead) table{margin-left:auto;margin-right:auto}div#p>svg>foreignObject>section[data-marpit-scope-2VUSmWEr]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-2VUSmWEr]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-hBbERbSk]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-hBbERbSk]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-PrJ4d1FU]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-PrJ4d1FU]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-fTnUNPVl]{font-size:28px}div#p>svg>foreignObject>section[data-marpit-scope-fTnUNPVl]{--marpit-root-font-size:28px}div#p>svg>foreignObject>section[data-marpit-scope-TMlnEwpK]{font-size:28px}div#p>svg>foreignObject>section[data-marpit-scope-TMlnEwpK]{--marpit-root-font-size:28px}div#p>svg>foreignObject>section[data-marpit-scope-rW4C1PsM]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-rW4C1PsM]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-R4Mx9mAp]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-R4Mx9mAp]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-DkadOLhs]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-DkadOLhs]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-Z698LQgL]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-Z698LQgL]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-yKL98tZF]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-yKL98tZF]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-D2rZ2GwQ]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-D2rZ2GwQ]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-f6ZryYpN]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-f6ZryYpN]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-9SZrjWIt]{font-size:28px}div#p>svg>foreignObject>section[data-marpit-scope-9SZrjWIt]{--marpit-root-font-size:28px}div#p>svg>foreignObject>section[data-marpit-scope-rqL9yXKb]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-rqL9yXKb]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-epiUnHWz]{font-size:25px}div#p>svg>foreignObject>section[data-marpit-scope-epiUnHWz]{--marpit-root-font-size:25px}div#p>svg>foreignObject>section[data-marpit-scope-zMZw8FV7]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-zMZw8FV7]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-KMY9Cv5h]{font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-KMY9Cv5h]{--marpit-root-font-size:30px}div#p>svg>foreignObject>section[data-marpit-scope-9GsxEpK7]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-9GsxEpK7]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-jC03FKlY]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-jC03FKlY]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-IV0s9aQw]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-IV0s9aQw]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-82bHaVi0]{font-size:27px}div#p>svg>foreignObject>section[data-marpit-scope-82bHaVi0]{--marpit-root-font-size:27px}div#p>svg>foreignObject>section[data-marpit-scope-WsAfeJu5]{font-size:32px}div#p>svg>foreignObject>section[data-marpit-scope-WsAfeJu5]{--marpit-root-font-size:32px}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]{columns:initial!important;display:block!important;padding:0!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:before,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:before{display:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction=vertical]{flex-direction:column}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split]>div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split,50%)}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split=right]>div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]>figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#p>svg>foreignObject>section[data-marpit-advanced-background=content],div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo]{background:transparent!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo],div#p>svg[data-marpit-svg]>foreignObject[data-marpit-advanced-background=pseudo]{pointer-events:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background-split]{width:100%;height:100%}</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id="p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-background-color="white" data-class="lead" data-theme="gaia" class="lead" style="--background-color:white;--class:lead;--theme:gaia;background-color:white;background-image:none;">
<h1>Lecture 3 Isolation and batch processing based on privilege level</h1>
<h2>The second section looks at RISC-V from the perspective of OS</h2>
<br />
<br />
<p>Xiang Yong Chen Yu Li Guoliang</p>
<br />
<br />
<p>Fall 2022</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="2" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<h3>1. Mainstream CPU Comparison</h3>
<ol start="2">
<li>RISC-V system mode</li>
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming</li>
<li>RISC-V system programming: kernel programming</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="3" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>The main goal of this section</h4>
<ul>
<li>Understand RISC-V privilege levels and hardware isolation methods</li>
<li>Understand the basic characteristics of RISC-V's M-Mode and S-Mode</li>
<li>Understand how the OS <strong>accesses and controls</strong> computer systems in M-Mode and S-Mode</li>
<li>Learn how different software can <strong>switch between M-Mode&lt;–&gt;S-Mode&lt;–&gt;U-Mode</strong></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="4" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Mainstream CPU Comparison</h4>

<p><img src="figs/mainstream-isas.png" alt="" style="width:1150px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-marpit-fragments="2" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="5" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Mainstream CPU Comparison</h4>
<ul>
<li data-marpit-fragment="1">Due to compatibility and historical reasons, the design and implementation of x86 and ARM are complicated</li>
<li data-marpit-fragment="2">RISC-V is concise/flexible/extensible</li>
</ul>
<p><img src="figs/x86-arm-rv-compare.png" alt="" style="width:1150px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="6" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
</ol>
<h3>2. RISC-V system mode</h3>
<ul>
<li>overview</li>
<li>Privileged</li>
<li>CSR register</li>
</ul>
<ol start="3">
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming</li>
<li>RISC-V system programming: kernel programming</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="7" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V related terms</h4>
<ul>
<li>Application Execution Environment (AEE)</li>
<li>Application Binary Interface (ABI)</li>
<li>Supervisor Binary Interface (SBI)</li>
<li>Supervisor Execution Environment (SEE)</li>
<li>Hypervisor: virtual machine monitor<br />
-Hypervisor Binary interface (HBI)</li>
<li>Hypervisor Execution Environment (HEE)</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-marpit-scope-2VUSmWEr="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="8" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /><br />
-ABI/SBI/HBI:Application/Supervisor/Hypervisor Bianry Interface<br />
-AEE/SEE/HEE:Application/Superv/Hyperv Execution Environment</p>
<ul>
<li>HAL: Hardware Abstraction Layer</li>
<li>Hypervisor, virtual machine monitor (virtual machine monitor, VMM)</li>
<li>RISC-V system mode is the RISC-V mode related to system programming</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-marpit-scope-hBbERbSk="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="9" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: single application scenario</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>Different software layers have clear privilege-level hardware isolation support</li>
<li>The <strong>single app</strong> on the left is coded to run on the ABI</li>
<li>ABI is the interface for interaction between user-level ISA (Instruction Set Architecture) and AEE</li>
<li>ABI hides the details of AEE from the application, making AEE more flexible</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-marpit-scope-PrJ4d1FU="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="10" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V System Mode: Operating System Scenarios</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>A <strong>traditional operating system</strong> is added in the middle to support multi-programming of multiple applications</li>
<li>Each application communicates with the OS via <strong>ABI</strong></li>
<li>The RISC-V operating system communicates with SEE through <strong>SBI</strong></li>
<li>SBI is the interface for the interaction between the OS kernel and SEE, and supports the ISA of the OS</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="11" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: virtual machine scenario</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>The virtual machine scene on the right can support <strong>multiple operating systems</strong></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="12" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V System Mode: Application Scenarios</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>M Mode: small devices (bluetooth headsets, etc.)</li>
<li>U+M Mode: Embedded device (TV remote control, credit card machine, etc.)</li>
<li>U+S+M Mode: mobile phone</li>
<li>U+S+H+M Mode: data center server</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-marpit-scope-fTnUNPVl="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="13" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V System Mode: Hardware Threading</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>Privileged level is a protection mechanism provided for different software stack components</li>
<li><strong>Hardware thread</strong> (hart, ie CPU core) is running at a privileged level (CSR configuration)</li>
<li>When the processor performs an operation that is not allowed by the current privileged mode, an <strong>exception</strong> will be generated. These exceptions usually generate a trap (trap) that causes the <strong>lower-level execution environment to take over control</strong></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="14" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode
<ul>
<li>overview</li>
<li><strong>Privileged</strong></li>
<li>CSR register</li>
</ul>
</li>
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming</li>
<li>RISC-V system programming: kernel programming</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="15" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: multiple privilege levels</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /><br />
-Modern processors generally have multiple privileged modes (Mode)</p>
<ul>
<li><strong>U</strong>: User | <strong>S</strong>: Supervisor | <strong>H</strong>: Hypervisor | <strong>M</strong>: Machine</li>
</ul>
<p>Why are there these <strong>4 modes</strong>? What are their <strong>differences and connections</strong>?</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="16" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V System Mode: Execution Environment</h4>
<table>
<thead>
<tr>
<th>Execution Environment</th>
<th>Encoding</th>
<th>Meaning</th>
<th>Across Privilege Levels</th>
</tr>
</thead>
<tbody>
<tr>
<td>APP</td>
<td>00</td>
<td>User/Application</td>
<td><code>ecall</code></td>
</tr>
<tr>
<td>OS</td>
<td>01</td>
<td>Supervisor</td>
<td><code>ecall</code> <code>sret</code></td>
</tr>
<tr>
<td>VMM</td>
<td>10</td>
<td>Hypervisor</td>
<td>---</td>
</tr>
<tr>
<td>BIOS</td>
<td>11</td>
<td>Machine</td>
<td><code>ecall</code> <code>mret</code></td>
</tr>
</tbody>
</table>
<ul>
<li>The combined hardware system of M, S, U is suitable for running UNIX-like operating systems</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="17" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: flexible combination of privilege levels</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>As the <strong>requirements of the application change</strong>, a <strong>flexible</strong> and <strong>combinable</strong> hardware structure is required</li>
<li>Therefore, the above four modes appeared, and the flexible hardware design that can be combined between the modes</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="18" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="18" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: user mode</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>U-Mode (User Mode, user mode, user mode)
<ul>
<li><strong>Unprivileged</strong> level mode (Unprivileged Mode): basic computing</li>
<li>It is the user-mode CPU execution mode of <strong>application running</strong></li>
<li>Cannot execute privileged instructions and cannot directly affect the execution of other applications</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-marpit-scope-TMlnEwpK="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="19" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: kernel mode</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>S-Mode (Supervisor Mode, Kernel Mode, kernel mode, kernel mode)
<ul>
<li>The operating system in the kernel mode has sufficient <strong>hardware control capability</strong></li>
<li>Privileged Mode: <strong>Limit APP</strong> execution and memory access</li>
<li>It is the kernel state CPU execution mode of <strong>operating system running</strong></li>
<li>Can execute kernel state privileged instructions, can directly <strong>affect application program execution</strong></li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-marpit-scope-rW4C1PsM="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="20" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: H-Mode</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>H-Mode (Hypervisor Mode, Virtual Machine Mode, virtual machine monitor)
<ul>
<li>Privileged mode: <strong>Limit the memory space accessed by the OS</strong></li>
<li>It is the Hypervisor Mode CPU execution mode of <strong>virtual machine monitor operation</strong>, which can execute H-Mode privileged instructions and can directly affect OS execution**</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-marpit-scope-R4Mx9mAp="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="21" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V system mode: M-Mode</h4>
<p><img src="figs/rv-privil-arch.png" alt="" style="width:800px;" /></p>
<ul>
<li>M-Mode (Machine Mode, Physical Machine Mode)
<ul>
<li>Privileged mode: <strong>control physical memory</strong>, directly shut down</li>
<li>It is the Machine Mode CPU execution mode of <strong>Bootloader/BIOS running</strong></li>
<li>Ability to execute M-Mode privileged instructions, which can directly affect the execution of other software mentioned above</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="22" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode
<ul>
<li>overview</li>
<li>Privileged</li>
<li><strong>CSR register</strong></li>
</ul>
</li>
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming</li>
<li>RISC-V system programming: kernel programming</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="23" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V CSR register classification</h4>
<ul>
<li><strong>General purpose registers</strong> x0-x31
<ul>
<li>General command access</li>
<li>Fastest memory location available to unprivileged instructions</li>
</ul>
</li>
<li><strong>Control Status Register</strong> (CSR: Control and Status Registers)
<ul>
<li>Accessed via the <strong>Control Status Register Instruction</strong>, there can be 4096 CSRs</li>
<li>Applications running in <strong>User Mode</strong> cannot access most of the CSR registers</li>
<li>The operating system running in <strong>kernel mode</strong> controls the computer by accessing the CSR register</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-marpit-scope-DkadOLhs="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="24" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Isolation via CSR register</h4>
<p>The OS ensures the safety and reliability of the computer through hardware isolation (three defenses)</p>
<ul>
<li>Set CSR (Control Status Register) to achieve isolation
<ul>
<li>Power: prevent applications from accessing system control related registers
<ul>
<li><strong>ADDRESS SPACE CONFIGURATION</strong> register: mstatus/sstatus CSR</li>
</ul>
</li>
<li>Time: Prevent apps from using 100% CPU for long periods of time
<ul>
<li><strong>Interrupt configuration</strong> register: sstatus/stvec CSR</li>
</ul>
</li>
<li>Data: Prevent app damage from stealing data
<ul>
<li><strong>Address space related</strong> registers: sstatus/satp/stvec CSR</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-marpit-scope-Z698LQgL="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="25" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode</li>
</ol>
<h3>3. RISC-V system programming: user mode programming</h3>
<ul>
<li>brief description</li>
<li>U-Mode programming: system calls</li>
<li>Privileged operations</li>
</ul>
<ol start="4">
<li>RISC-V system programming: M-Mode programming</li>
<li>RISC-V system programming: kernel programming</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="26" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>System Programming Brief</h4>
<ul>
<li>System programming needs to understand the <strong>privileged level architecture</strong> of the processor, and be familiar with the register resources, memory resources and peripheral resources that can be accessed by each privileged level</li>
<li><strong>Write kernel-level code</strong>, construct an operating system, and support application execution
<ul>
<li>Memory management process scheduling</li>
<li>Exception handling Interrupt handling</li>
<li>System calls Peripheral control</li>
</ul>
</li>
<li>System programming is usually <strong>not supported by <strong>extensive user</strong> programming libraries</strong> and convenient dynamic <strong>debugging tools</strong></li>
<li>The system programming of this course mainly focuses on S-Mode and U-Mode of RISC-V, involving some understanding of M-Mode</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="27" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V U-Mode programming: using system calls</h4>
<ul>
<li>Applications under U-Mode cannot directly use the physical resources of the computer</li>
<li>Environment call exception: Occurs when executing <code>ecall</code>, which is equivalent to a system call</li>
<li>OS can directly access physical resources</li>
<li>What if the application needs to use hardware resources?
<ul>
<li>print &quot;hello world&quot; to the screen</li>
<li>read data from file</li>
</ul>
</li>
<li>Obtain services from the operating system through system calls</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="28" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>U-Mode programming: first example &quot;hello world&quot;</h4>
<p><a href="https://github.com/chyyuu/os_kernel_lab/tree/v4-kernel-sret-app-ecall-kernel/os/src">Small example of printing &quot;hello world&quot; in user mode</a> roughly execution flow</p>
<p><img src="figs/print-app.png" alt="" style="width:1000px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="29" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Start execution of the first example</h4>
<p><a href="https://github.com/chyyuu/os_kernel_lab/blob/v4-kernel-sret-app-ecall-kernel/os/src/main.rs#L302">A small example of printing &quot;hello world&quot; in user mode</a> Start the execution flow</p>
<p><img src="figs/boot-print-app.png" alt="" style="width:1000px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="30" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>The second example: Executing privileged instructions in user mode</h4>
<p>[A small example of executing privileged instructions in user mode](<a href="https://github.com/chyyuu/os_kernel_lab/blob/v4-illegal-priv-code-csr-in-u-mode-app-v2/os/src/">https://github.com/chyyuu/os_kernel_lab/blob/v4-illegal-priv-code-csr-in-u-mode-app-v2/os/src/</a> main.rs#L306) Startup and execution process</p>
<p><img src="figs/boot-priv-code-app.png" alt="" style="width:1000px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="31" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Privileged Operations</h4>
<ul>
<li>
<p>Privileged operations: privileged instructions and CSR read and write operations</p>
</li>
<li>
<p>Very few instructions:</p>
<ul>
<li><code>mret</code> machine mode return</li>
<li><code>sret</code> supervisor mode return</li>
<li><code>wfi</code> wait for interrupt</li>
<li><code>sfence.vma</code> virtual address barrier (barrier) instruction</li>
</ul>
</li>
<li>
<p>Many other system management functions are implemented by reading and writing the control status register</p>
</li>
</ul>
<p>Note: <code>fence.i</code> is an i-cache barrier (barrier) instruction, a non-privileged instruction, which belongs to the &quot;Zifencei&quot; extended specification</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-marpit-scope-yKL98tZF="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="32" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode</li>
<li>RISC-V system programming: user mode programming</li>
</ol>
<h3>4. RISC-V system programming: M-Mode programming</h3>
<ul>
<li>Interrupt mechanism and exception mechanism</li>
<li>Hardware response to interrupt/exception</li>
<li>Handover of control for interrupt/exception handling</li>
</ul>
<ol start="5">
<li>RISC-V system programming: kernel programming</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="33" data-marpit-scope-D2rZ2GwQ="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="33" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>M-Mode programming</h4>
<ul>
<li>M-Mode is the <strong>highest authority mode</strong> of hart (hardware thread) in RISC-V</li>
<li>In M-Mode, hart has <strong>full access to the underlying functions of the computer system</strong></li>
<li>The most important feature of M-Mode is <strong>intercept and handle interrupt/exception</strong>
<ul>
<li><strong>Synchronous exception</strong>: generated during execution, accessing an invalid register address, or executing an instruction with an invalid opcode</li>
<li><strong>Asynchronous Interrupt</strong>: Instruction flow asynchronous external events, interrupts, such as clock interrupts</li>
</ul>
</li>
<li>RISC-V requires the implementation of <strong>precise exception</strong>: to ensure that all instructions before the exception are fully executed, and subsequent instructions have not started to execute</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="34" data-marpit-scope-f6ZryYpN="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="34" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>M-Mode interrupt control and status register</h4>
<ul>
<li>mtvec(MachineTrapVector) saves the <strong>interrupt processing routine entry address</strong> to be jumped to when an interrupt/exception occurs</li>
<li>mepc(Machine Exception PC) points to the <strong>instruction when an interrupt/exception occurred</strong></li>
<li>mcause(Machine Exception Cause) indicates the type of <strong>interrupt/exception</strong> that occurred</li>
<li>mie(Machine Interrupt Enable) interrupt <strong>enable</strong> register</li>
<li>mip (Machine Interrupt Pending) interrupt <strong>request</strong> register</li>
<li>mtval(Machine Trap Value) saves trapped (trap) <strong>Additional Information</strong></li>
<li>mscratch (Machine Scratch) it temporarily stores a word-sized <strong>data</strong></li>
<li>mstatus(Machine Status) saves global interrupts and other <strong>status</strong></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-marpit-scope-9SZrjWIt="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="35" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Mstatus CSR register</h4>
<ul>
<li>mstatus(Machine Status) saves global interrupts and other <strong>status</strong>
<ul>
<li>SIE controls the global interrupt in S-Mode, and MIE controls the global interrupt in M-Mode.</li>
<li>SPIE, MPIE records the values of MIE and SIE before the interruption occurred.</li>
<li>SPP indicates whether the privilege level before the change is S-Mode or U-Mode</li>
<li>MPP indicates whether it was S-Mode, U-Mode or M-Mode before the change<br />
PP: Previous Privilege</li>
</ul>
</li>
</ul>
<p><img src="figs/mstatus.png" alt="" style="width:1000px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="36" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Mcause CSR register</h4>
<p>When an exception occurs, a code indicating <strong>the event that caused the exception</strong> is written in the mcause CSR. If the event is caused by an interrupt, the <code>Interrupt</code> bit is set, and the <code>Exception Code</code> field contains the indication of the last An unusual encoding.</p>
<p><img src="figs/rv-cause.png" alt="" style="width:1150px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="37" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="37" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>M-Mode Clock Interrupt Timer</h4>
<ul>
<li>Interrupts happen asynchronously
<ul>
<li>Signals from I/O devices external to the processor</li>
</ul>
</li>
<li>Timer can generate interrupts in a stable and regular manner
<ul>
<li>Prevent the application program from occupying the CPU, so that the OS Kernel can get the execution right...</li>
<li>CPU control by <strong>software in high privilege mode</strong></li>
<li>Software in high privilege mode can <strong>authorize</strong> low privilege mode software to handle interrupts</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="38" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="38" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V processor FU540 module diagram</h4>
<p><img src="figs/fu540-top-block.png" alt="" style="width:650px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="39" data-marpit-scope-rqL9yXKb="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="39" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode</li>
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming
<ul>
<li>Interrupt mechanism and exception mechanism</li>
</ul>
</li>
</ol>
<h3>Interrupt/exception hardware response</h3>
<ul>
<li>Handover of control for interrupt/exception handling</li>
</ul>
<ol start="5">
<li>RISC-V system programming: kernel programming</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="40" data-marpit-scope-epiUnHWz="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="40" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>M-Mode interrupt hardware response process</h4>
<ul>
<li>The PC of the <strong>abnormal instruction</strong> is saved in mepc, and the PC is set to mtvec.
<ul>
<li>For synchronous exceptions, mepc points to the instruction that caused the exception;</li>
<li>For interrupts, points to where execution should resume after interrupt handling.</li>
</ul>
</li>
<li>Set mcause according to <strong>exception source</strong>, and set mtval to error address or other information word suitable for <strong>specific exception</strong></li>
<li>Set mstatus[MIEbit] to zero to <strong>disable interrupts</strong> and <strong>keep previous MIE value</strong> into MPIE
<ul>
<li>SIE controls the global interrupt in S mode, MIE controls the global interrupt in M mode;</li>
<li>SPIE records the value before SIE interruption, and MPIE records the value before MIE interruption</li>
</ul>
</li>
<li><strong>Reserve the permission mode before the exception occurred</strong> to the MPP domain of mstatus, and then <strong>change the permission mode</strong> to M. (MPP indicates that the privilege level before the change is S, M or U mode)</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="41" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="41" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>M-Mode interrupt handling routine</h4>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>     let cause = cause::read();
     let stval = stval::read();

     match cause. cause() {
         Trap::Exception(Exception::UserEnvCall) =&gt; {
             cx.sepc += 4;
             cx.x[10] = do_syscall(cx.x[17], [cx.x[10], cx.x[11], cx.x[12]]) as usize;
         }
         _ =&gt; {
             panic!(
                 &quot;Unsupported trap {:?}, stval = {:#x}!&quot;,
                 cause. cause(),
                 stval
             );
         }
     }

</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="42" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="42" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>M-Mode interrupt classification</h4>
<p>The type of interrupt is obtained by different bits (mie) of the mcause register.</p>
<ul>
<li><strong>Software</strong> interrupt: Triggered by writing data to a memory-mapped register, one hart interrupts another hart (interprocessor interrupt)</li>
<li><strong>Clock</strong> interrupt: hart's time counter register mtime is greater than time comparison register mtimecmp</li>
<li><strong>External</strong> interrupt: Triggered by the interrupt controller, in most cases the peripherals will be connected to this interrupt controller</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="43" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="43" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>RISC-V Interrupts/Exceptions</h4>
<p>The information of the interrupt source is obtained through different bits of the mcause register.<br />
The first column 1 represents the interrupt, the second column represents the interrupt ID, and the third column represents the interrupt meaning<br />
<img src="figs/rv-interrupt.png" alt="" style="width:1000px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="44" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;--marpit-advanced-background-split:45%;" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;figs/rv-exception.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="55%" height="720"><section id="44" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="44" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;--marpit-advanced-background-split:45%;" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h4>M-Mode RISC-V exception mechanism</h4>
<p>The information that caused the exception is obtained through different bits of the mcause register.<br />
The first column 0 represents the exception, the second column represents the exception ID, and the third column represents the meaning of the exception<br />
</p>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="44" data-marpit-pagination-total="66" style="" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="45" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="45" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>M-Mode interrupt/abnormal hardware response</h4>
<ul>
<li>The PC of the interrupt/exception instruction is stored in mepc, and the PC is set to mtvec.
<ul>
<li>For exceptions, mepc points to the instruction that caused the exception</li>
<li>For interrupts, mepc points to where execution should resume after interrupt handling</li>
</ul>
</li>
<li>Set mcause according to the <strong>interrupt/exception source</strong> and set mtval to the address of the error or other information word suitable for the specific exception.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="46" data-marpit-scope-zMZw8FV7="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="46" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Handover of M-Mode interrupt/exception handling</h4>
<ul>
<li><strong>mideleg/medeleg</strong> (Machine Interrupt/Exception Delegation) CSR controls which interrupts/exceptions are delegated to S-Mode for processing</li>
<li>Each of mideleg/medeleg corresponds to an interrupt/exception
<ul>
<li>If mideleg[5] corresponds to the S-Mode clock interrupt, if it is set, the S-Mode clock interrupt will be handed over to the S-Mode interrupt/exception handler instead of the M-Mode interrupt/exception handler program</li>
<li>Any interrupts delegated to S-Mode can be masked by S-Mode software. sie (Supervisor Interrupt Enable) and sip (Supervisor Interrupt Pending) CSR are S-Mode control status registers</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="47" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="47" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Interrupt delegation register mideleg</h4>
<ul>
<li>Mideleg (Machine Interrupt Delegation) controls which interrupts are delegated to S-mode processing</li>
<li>Each bit in mideleg corresponds to an interrupt/exception
<ul>
<li>mideleg[1] is used to control whether <strong>inter-core interrupt</strong> is handed over to s mode for processing</li>
<li>mideleg[5] is used to control whether to hand over <strong>timing interrupt</strong> to s mode for processing</li>
<li>mideleg[9] is used to control whether to hand over <strong>external interrupt</strong> to s mode for processing</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="48" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="48" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Exception delegation register medeleg</h4>
<ul>
<li>Medeleg (Machine Exception Delegation) controls which exceptions are delegated to S mode for processing</li>
<li>Each in the medeleg corresponds to an interrupt/exception
<ul>
<li>medeleg[1] is used to control whether to hand over the <strong>instruction acquisition error exception</strong> to the s mode for processing</li>
<li>medeleg[12] is used to control whether to hand over <strong>instruction page exception</strong> to s mode for processing</li>
<li>medeleg[9] is used to control whether <strong>data page exception</strong> is handed over to s mode for processing</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="49" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="49" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Handover of control for interrupt/exception handling</h4>
<ul>
<li>When an interrupt/exception occurs, processor control <strong>usually</strong> will not be handed over to a less privileged mode
<ul>
<li>eg medeleg[15] will delegate store page fault to S-Mode</li>
<li>Exceptions that occur in M-Mode are always handled in M-Mode</li>
<li>Exceptions in S-Mode are always handled in M-Mode, or in S-Mode</li>
<li>Exceptions that occur in the above two modes will not be handled by U-Mode</li>
</ul>
</li>
</ul>
<p><strong>Why?</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="50" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="50" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Thinking questions</h4>
<ul>
<li>How to implement the breakpoint debugging function of the debugger through the breakpoint exception?</li>
<li>How to implement single-step tracking?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="51" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="51" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode</li>
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming</li>
</ol>
<h3>5. RISC-V system programming: kernel programming</h3>
<ul>
<li>Interrupt/exception mechanism</li>
<li>Interrupt/exception handling</li>
<li>Virtual memory mechanism</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="52" data-marpit-scope-KMY9Cv5h="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="52" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode interrupt control and status register</h4>
<ul>
<li>stvec(SupervisorTrapVector) saves the address <strong>to jump to when an interrupt/exception occurs</strong></li>
<li>sepc(Supervisor Exception PC) points to the <strong>instruction when an interrupt/exception occurred</strong></li>
<li>cause(Supervisor Exception Cause) indicates the <strong>kind</strong> of the interrupt/exception that occurred</li>
<li>sie(Supervisor Interrupt Enable) interrupt <strong>enable</strong> register</li>
<li>sip (Supervisor Interrupt Pending) interrupt <strong>request</strong> register</li>
<li>stval(Supervisor Trap Value) saves trap (trap) <strong>Additional Information</strong></li>
<li>sscratch (Supervisor Scratch) different mode exchange <strong>data transfer station</strong></li>
<li>sstatus (Supervisor Status) saves global interrupts and other <strong>status</strong></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="53" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="53" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Sstatus register</h4>
<ul>
<li>The SIE and SPIE bits of sstatus respectively save the current and interrupt enable <strong>status</strong> before the interrupt/exception occurs</li>
</ul>
<p><img src="figs/rv-sstatus.png" alt="" style="width:1100px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="54" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="54" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode Interrupt/Exception Mechanism</h4>
<p><strong>sie &amp; sip register</strong> is a CSR used to save <strong>pending interrupt</strong> and <strong>interrupt enable</strong></p>
<ul>
<li>sie (supervisor interrupt-enabled register)</li>
<li>sip (supervisor interrupt pending)</li>
</ul>
<p><img src="figs/rv-sie-sip.png" alt="" style="width:1150px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="55" data-marpit-scope-9GsxEpK7="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="55" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Scause register</h4>
<p>When an exception occurs, an event number indicating <strong>causing an interrupt/abnormal event</strong> is written in the CSR, recorded in the <code>Exception Code</code> field; if the event is caused by an interrupt, the <code>Interrupt</code> bit is set.<br />
cause register</p>
<p><img src="figs/rv-cause.png" alt="" style="width:1150px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="56" data-marpit-scope-jC03FKlY="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="56" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>Mtvec &amp; stvec registers</h4>
<p>The interrupt/exception vector (trap-vector) base address register stvec CSR is used to configure the <strong>trap_handler address</strong></p>
<ul>
<li>Includes vector base address (BASE) and vector mode (MODE): the value in the BASE field is 4-byte aligned
<ul>
<li>MODE = 0 means a trap_handler handles all interrupts/exceptions</li>
<li>MODE = 1 means each interrupt/exception has a corresponding trap_handler</li>
</ul>
</li>
</ul>
<p>mtvec &amp; stvec registers<br />
<img src="figs/rv-tvec.png" alt="" style="width:1000px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="57" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="57" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode</li>
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming</li>
<li>RISC-V system programming: kernel programming
<ul>
<li>Interrupt/exception mechanism</li>
<li><strong>Interrupt/Exception Handling</strong></li>
<li>Virtual memory mechanism</li>
</ul>
</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="58" data-marpit-scope-IV0s9aQw="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="58" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode interrupt/abnormal hardware response</h4>
<p><strong>Hardware Execution Content</strong></p>
<p>The hart accepts the interrupt/exception and needs to be delegated to S-Mode, then the hardware will undergo the following state transitions atomically</p>
<ol>
<li><strong>Interrupt/abnormal instruction PC</strong> is stored in sepc, and PC is set to stvec</li>
<li>scause sets interrupt/abnormal <strong>type</strong>, stval is set to error address/abnormal <strong>related information</strong></li>
<li>Set the SIE bit in sstatus to zero, <strong>mask the interrupt</strong>, the value before the <strong>SIE bit</strong> is saved in the SPIE bit</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="59" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="59" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode interrupt/abnormal hardware response</h4>
<ol start="4">
<li><strong>The privilege mode before the exception occurred</strong> is saved in the SPP (previous privilege) field of sstatus, and then set the current privilege mode to S-Mode</li>
<li><strong>Jump</strong> to the address set by stvec CSR to continue execution</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="60" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="60" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode Interrupt/Exception Software Handling</h4>
<ul>
<li><strong>Initialization</strong>
<ul>
<li>Write interrupt/exception handling routines (such as trap_handler)</li>
<li>Set trap_handler address to stvec</li>
</ul>
</li>
<li>Software execution
<ol>
<li>The processor jumps to <strong>trap_handler</strong></li>
<li>trap_handler <strong>handling</strong> interrupt/exception/system call, etc.</li>
<li><strong>Return</strong> to the previous instruction and the previous privilege level to continue execution</li>
</ol>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="61" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="61" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<p><strong>Outline</strong></p>
<ol>
<li>Mainstream CPU Comparison</li>
<li>RISC-V system mode</li>
<li>RISC-V system programming: user mode programming</li>
<li>RISC-V system programming: M-Mode programming</li>
<li>RISC-V system programming: kernel programming
<ul>
<li>Interrupt/exception mechanism</li>
<li>Interrupt/exception handling</li>
<li><strong>Virtual storage mechanism</strong></li>
</ul>
</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="62" data-marpit-scope-82bHaVi0="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="62" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode virtual memory system</h4>
<ul>
<li>Virtual addresses divide memory into <strong>fixed-size pages</strong> for <strong>address translation</strong> and <strong>content protection</strong>.</li>
<li>satp (Supervisor Address Translation and Protection, supervisor address translation and protection) S mode control status register <strong>control paging</strong>. satp has three domains:
<ul>
<li>The MODE field can <strong>turn on pagination</strong> and select the number of page table levels</li>
<li>ASID (Address Space Identifier, Address Space Identifier) field is optional, it can be used to reduce the overhead of context switching</li>
<li>The PPN field holds the physical page number of the <strong>root page table</strong><br />
<img src="figs/satp.png" alt="" style="width:900px;" /></li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="63" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;--marpit-advanced-background-split:50%;" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;figs/riscv_pagetable.svg&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="63" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="63" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;--marpit-advanced-background-split:50%;" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h4>S-Mode Virtual Storage Mechanism</h4>
<ul>
<li>Establish <strong>page table base address</strong> through stap CSR</li>
<li>Create <strong>page tables</strong> for OS and APP</li>
<li>Handle memory access <strong>Exception</strong></li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="63" data-marpit-pagination-total="66" style="" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="64" data-marpit-scope-WsAfeJu5="" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="64" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode virtual memory address translation</h4>
<p>In S, U-Mode, the virtual address will be converted to a physical address by traversing the page table from the root:</p>
<ul>
<li>satp.PPN gives the <strong>first-level page table base address</strong>, VA [31:22] gives the first-level page number, and the CPU will read the address located at (satp.PPN × 4096 + VA[31: 22 ] × 4) Page table entry.</li>
<li>PTE contains <strong>secondary page table base address</strong>, VA[21:12] gives the second-level page number, CPU reads at address (PTE. PPN × 4096 + VA[21: 12] × 4) leaf Node page table entry.</li>
<li><strong>The PPN field of the leaf node page table entry</strong> and the page offset (the lowest 12 effective bits of the original virtual address) form the final result: physical address (LeafPTE.PPN×4096+VA[11: 0])</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="65" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="65" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h4>S-Mode virtual memory address translation</h4>
<p><img src="figs/satp2.png" alt="" style="width:650px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="66" data-paginate="true" data-background-color="white" data-theme="gaia" data-marpit-pagination="66" data-marpit-pagination-total="66" style="--paginate:true;--background-color:white;--theme:gaia;background-color:white;background-image:none;">
<h3>Summary</h3>
<ul>
<li>Understand RISC-V privilege levels and hardware isolation methods</li>
<li>Understand the basic characteristics of RISC-V's M-Mode and S-Mode</li>
<li>Understand how the OS accesses and controls the computer system in M-Mode and S-Mode</li>
<li>Learn how different software switches between M-Mode&lt;–&gt;S-Mode&lt;–&gt;U-Mode</li>
</ul>
</section>
<script>!function(){"use strict";const t={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},e="data-marp-auto-scaling-wrapper",i="data-marp-auto-scaling-svg",n="data-marp-auto-scaling-container";class s extends HTMLElement{constructor(){super(),this.svgPreserveAspectRatio="xMinYMid meet";const t=t=>([e])=>{const{width:i,height:n}=e.contentRect;this[t]={width:i,height:n},this.updateSVGRect()};this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(t("containerSize")),this.wrapperObserver=new ResizeObserver(((...e)=>{t("wrapperSize")(...e),this.flushSvgDisplay()}))}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){var t,s,o,r,a;this.shadowRoot.innerHTML=`\n<style>\n  svg[${i}] { display: block; width: 100%; height: auto; vertical-align: top; }\n  span[${n}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }\n</style>\n<div ${e}>\n  <svg part="svg" ${i}>\n    <foreignObject><span ${n}><slot></slot></span></foreignObject>\n  </svg>\n</div>\n    `.split(/\n\s*/).join(""),this.wrapper=null!==(t=this.shadowRoot.querySelector(`div[${e}]`))&&void 0!==t?t:void 0;const l=this.svg;this.svg=null!==(o=null===(s=this.wrapper)||void 0===s?void 0:s.querySelector(`svg[${i}]`))&&void 0!==o?o:void 0,this.svg!==l&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=null!==(a=null===(r=this.svg)||void 0===r?void 0:r.querySelector(`span[${n}]`))&&void 0!==a?a:void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:t}=this;t&&(t.style.display="inline",requestAnimationFrame((()=>{t.style.display=""})))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(t){const e=()=>{const i=(()=>{const e=t.getPropertyValue("--preserve-aspect-ratio");if(e)return e.trim();return`x${(({textAlign:t,direction:e})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if("start"===t||"end"===t){let i="rtl"===e;return"end"===t&&(i=!i),i?"Max":"Min"}return"Mid"})(t)}YMid meet`})();i!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=i,this.updateSVGRect()),t===this.svgComputedStyle&&requestAnimationFrame(e)};e()}updateSVGRect(){var t,e,i,n,s,o,r;let a=Math.ceil(null!==(e=null===(t=this.containerSize)||void 0===t?void 0:t.width)&&void 0!==e?e:0);const l=Math.ceil(null!==(n=null===(i=this.containerSize)||void 0===i?void 0:i.height)&&void 0!==n?n:0);void 0!==this.dataset.downscaleOnly&&(a=Math.max(a,null!==(o=null===(s=this.wrapperSize)||void 0===s?void 0:s.width)&&void 0!==o?o:0));const c=null===(r=this.svg)||void 0===r?void 0:r.querySelector(":scope > foreignObject");if(null==c||c.setAttribute("width",`${a}`),null==c||c.setAttribute("height",`${l}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${a} ${l}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=a<=0||l<=0?"0":""),this.container){const t=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=t.startsWith("xmid")||t.startsWith("xmax")?"auto":"0",this.container.style.marginRight=t.startsWith("xmi")?"auto":"0"}}}const o=(t,{attrs:e={},style:i})=>class extends t{constructor(...t){super(...t);for(const[t,i]of Object.entries(e))this.hasAttribute(t)||this.setAttribute(t,i);this.attachShadow({mode:"open"})}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_update(){const t=i?`<style>:host { ${i} }</style>`:"";let e="<slot></slot>";const{autoScaling:n}=this.dataset;if(void 0!==n){e=`<marp-auto-scaling exportparts="svg:auto-scaling" ${"downscale-only"===n?"data-downscale-only":""}>${e}</marp-auto-scaling>`}this.shadowRoot.innerHTML=t+e}};let r;const a=Symbol(),l="marpitSVGPolyfill:setZoomFactor,",c=Symbol();let d,p;function h(t){const e="object"==typeof t&&t.target||document,i="object"==typeof t?t.zoom:t;window[c]||(Object.defineProperty(window,c,{configurable:!0,value:!0}),window.addEventListener("message",(({data:t,origin:e})=>{if(e===window.origin)try{if(t&&"string"==typeof t&&t.startsWith(l)){const[,e]=t.split(","),i=Number.parseFloat(e);Number.isNaN(i)||(p=i)}}catch(t){console.error(t)}})));let n=!1;Array.from(e.querySelectorAll("svg[data-marpit-svg]"),(t=>{var e,s,o,r;t.style.transform||(t.style.transform="translateZ(0)");const a=i||p||t.currentScale||1;d!==a&&(d=a,n=a);const l=t.getBoundingClientRect(),{length:c}=t.children;for(let i=0;i<c;i+=1){const n=t.children[i];if(n.getScreenCTM){const t=n.getScreenCTM();if(t){const i=null!==(s=null===(e=n.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==s?s:0,c=null!==(r=null===(o=n.y)||void 0===o?void 0:o.baseVal.value)&&void 0!==r?r:0,d=n.children.length;for(let e=0;e<d;e+=1){const s=n.children[e];if("SECTION"===s.tagName){const{style:e}=s;e.transformOrigin||(e.transformOrigin=`${-i}px ${-c}px`),e.transform=`scale(${a}) matrix(${t.a}, ${t.b}, ${t.c}, ${t.d}, ${t.e-l.left}, ${t.f-l.top}) translateZ(0.0001px)`;break}}}}}})),!1!==n&&Array.from(e.querySelectorAll("iframe"),(({contentWindow:t})=>{null==t||t.postMessage(`${l}${n}`,"null"===window.origin?"*":window.origin)}))}function g({once:t=!1,target:e=document}={}){const i="Apple Computer, Inc."===navigator.vendor?[h]:[];let n=!t;const s=()=>{for(const t of i)t({target:e});n&&window.requestAnimationFrame(s)};return s(),()=>{n=!1}}d=1,p=void 0;const m=Symbol(),v=(e=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const i=window[a];i||customElements.define("marp-auto-scaling",s);for(const n of Object.keys(t)){const s=`marp-${n}`,a=t[n].proto();null!=r||(r=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is")),r&&a!==HTMLElement?i||customElements.define(s,o(a,{style:t[n].style}),{extends:n}):(i||customElements.define(s,o(HTMLElement,t[n])),e.querySelectorAll(`${n}[is="${s}"]`).forEach((t=>{t.outerHTML=t.outerHTML.replace(new RegExp(`^<${n}`,"i"),`<${s}`).replace(new RegExp(`</${n}>$`,"i"),`</${s}>`)})))}window[a]=!0})(e),e[m])return e[m];const i=g({target:e}),n=()=>{i(),delete e[m]},l=Object.assign(n,{cleanup:n,update:()=>v(e)});return Object.defineProperty(e,m,{configurable:!0,value:l}),l},u=document.currentScript;v(u?u.getRootNode():document)}();
</script></foreignObject></svg></div><div class="bespoke-marp-note" data-index="3" tabindex="0"><p>Mainly explain that x86, arm due to compatibility and historical reasons, lead to complex design and implementation, riscv is simple/flexible/extensible, easy to learn and master and used to write OS</p></div><div class="bespoke-marp-note" data-index="22" tabindex="0"><p>## RISC-V system mode: control status register CSR
Mandatory isolation to avoid availability/reliability/security impact on the entire system</p></div><div class="bespoke-marp-note" data-index="23" tabindex="0"><p>## RISC-V 系统模式：控制状态寄存器CSR

- mtvec(MachineTrapVector)保存发生异常时需要跳转到的地址。
- mepc(Machine Exception PC)指向发生异常的指令。
- mcause(Machine Exception Cause)指示发生异常的种类。
- mie(Machine Interrupt Enable)指出处理器目前能处理的中断。
- mip(Machine Interrupt Pending)列出目前正准备处理的中断。
- mtval(Machine Trap Value)保存陷入(trap)附加信息:地址例外中出错的地址、发生非法指令例外的指令本身；对于其他异常，值为0。
- mscratch(Machine Scratch)它暂时存放一个字大小的数据。
- mstatus(Machine Status)保存全局中断以及其他的状态</p><p>---
## RISC-V 系统模式：控制状态寄存器CSR

- mcause(Machine Exception Cause)它指示发生异常的种类。
  - SIE控制S-Mode下全局中断，MIE控制M-Mode下全局中断。
  - SPIE、MPIE记录发生中断之前MIE和SIE的值。
---
## RISC-V 系统模式：控制状态寄存器CSR

- sstatus(supervisor status)保存发生异常时需要跳转到的地址。
- stvec(supervisor trap vector)保存s模式的trap向量基址。stvec总是4字节对齐
- satp(supervisor Address Translation and Protection) S-Mode控制状态寄存器控制了分页系统。
- sscratch (supervisor Scratch Register) 保存指向hart-local supervisor上下文的指针. 在trap处理程序的开头，sscratch与用户寄存器交换，以提供初始工作寄存器。
- sepc(supervisor Exception PC)它指向发生异常的指令。</p></div><div class="bespoke-marp-note" data-index="29" tabindex="0"><p>Zifencei extension https://www.cnblogs.com/mikewolf2002/p/11191254.html</p></div><div class="bespoke-marp-note" data-index="30" tabindex="0"><p>Before executing the fence.i instruction, for the same hardware thread (hart), RISC-V does not guarantee that the data written to the memory instruction area by the store instruction can be fetched by the fetch instruction. After using the fence.i command, for the same hart, you can ensure that the command reads the data that was written to the memory command area recently. However, fence.i will not guarantee that the reading of other riscv hart instructions can also meet the read and write consistency. If you want to make the write instruction memory space meet the consistency requirements for all harts, you need to execute the fence instruction.</p></div><div class="bespoke-marp-note" data-index="33" tabindex="0"><p>mtval (Machine Trap Value) saves the additional information of the trap: the address of the error in the address exception, the instruction itself where the exception of the illegal instruction occurred; for other exceptions, the value is 0.</p></div><div class="bespoke-marp-note" data-index="47" tabindex="0"><p>, is a subset of mie and mip. These two registers have the same layout as in M-Mode. In sie and sip, only bits corresponding to interrupts delegated by mideleg can be read and written, and bits corresponding to interrupts not delegated are always 0</p></div><div class="bespoke-marp-note" data-index="64" tabindex="0"><p>---
## RISC-V System Programming: Isolation in S-Mode
- S-Mode is more privileged than U-Mode, but less privileged than M-Mode
- Software running in S-Mode cannot use M-Mode CSR and instructions, and is restricted by PMP
- Support page-based virtual memory</p></div><script>/*!! License: https://unpkg.com/@marp-team/marp-cli@2.3.0/lib/bespoke.js.LICENSE.txt */
!function(){"use strict";const e=document.body,t=(...e)=>history.replaceState(...e),n="presenter",r="next",o=["",n,r],i="bespoke-marp-",a=`data-${i}`,s=(e,{protocol:t,host:n,pathname:r,hash:o}=location)=>{const i=e.toString();return`${t}//${n}${r}${i?"?":""}${i}${o}`},l=()=>e.dataset.bespokeView,d=e=>new URLSearchParams(location.search).get(e),c=(e,n={})=>{var r;const o={location,setter:t,...n},i=new URLSearchParams(o.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?i.set(t,n):i.delete(t)}try{o.setter({...null!==(r=window.history.state)&&void 0!==r?r:{}},"",s(i,o.location))}catch(e){console.error(e)}},u=(()=>{const e="bespoke-marp";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}})(),f=e=>{try{return localStorage.getItem(e)}catch(e){return null}},m=(e,t)=>{try{return localStorage.setItem(e,t),!0}catch(e){return!1}},g=e=>{try{return localStorage.removeItem(e),!0}catch(e){return!1}},p=(e,t)=>{const n="aria-hidden";t?e.setAttribute(n,"true"):e.removeAttribute(n)},v=e=>{e.parent.classList.add(`${i}parent`),e.slides.forEach((e=>e.classList.add(`${i}slide`))),e.on("activate",(t=>{const n=`${i}active`,r=t.slide,o=r.classList,a=!o.contains(n);if(e.slides.forEach((e=>{e.classList.remove(n),p(e,!0)})),o.add(n),p(r,!1),a){const e=`${n}-ready`;o.add(e),document.body.clientHeight,o.remove(e)}}))},h=e=>{let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map((e=>[null,...e.querySelectorAll("[data-marpit-fragment]")]))});const r=r=>void 0!==e.fragments[t][n+r],o=(r,o)=>{t=r,n=o,e.fragments.forEach(((e,t)=>{e.forEach(((e,n)=>{if(null==e)return;const i=t<r||t===r&&n<=o;e.setAttribute(`${a}fragment`,(i?"":"in")+"active");const s=`${a}current-fragment`;t===r&&n===o?e.setAttribute(s,"current"):e.removeAttribute(s)}))})),e.fragmentIndex=o;const i={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:o};e.fire("fragment",i)};e.on("next",(({fragment:i=!0})=>{if(i){if(r(1))return o(t,n+1),!1;const i=t+1;e.fragments[i]&&o(i,0)}else{const r=e.fragments[t].length;if(n+1<r)return o(t,r-1),!1;const i=e.fragments[t+1];i&&o(t+1,i.length-1)}})),e.on("prev",(({fragment:i=!0})=>{if(r(-1)&&i)return o(t,n-1),!1;const a=t-1;e.fragments[a]&&o(a,e.fragments[a].length-1)})),e.on("slide",(({index:t,fragment:n})=>{let r=0;if(void 0!==n){const o=e.fragments[t];if(o){const{length:e}=o;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}o(t,r)})),o(0,0)},y=document,b=()=>!(!y.fullscreenEnabled&&!y.webkitFullscreenEnabled),w=()=>!(!y.fullscreenElement&&!y.webkitFullscreenElement),x=e=>{e.fullscreen=()=>{b()&&(async()=>{return w()?null===(e=y.exitFullscreen||y.webkitExitFullscreen)||void 0===e?void 0:e.call(y):((e=y.body)=>{var t;return null===(t=e.requestFullscreen||e.webkitRequestFullscreen)||void 0===t?void 0:t.call(e)})();var e})()},document.addEventListener("keydown",(t=>{"f"!==t.key&&"F11"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!b()||(e.fullscreen(),t.preventDefault())}))},k=`${i}inactive`,$=(e=2e3)=>({parent:t,fire:n})=>{const r=t.classList,o=e=>n(`marp-${e?"":"in"}active`);let i;const a=()=>{i&&clearTimeout(i),i=setTimeout((()=>{r.add(k),o()}),e),r.contains(k)&&(r.remove(k),o(!0))};for(const e of["mousedown","mousemove","touchend"])document.addEventListener(e,a);setTimeout(a,0)},E=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"],L=e=>{e.parent.addEventListener("keydown",(e=>{if(!e.target)return;const t=e.target;(E.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()}))},S=e=>{window.addEventListener("load",(()=>{for(const t of e.slides){const e=t.querySelector("marp-auto-scaling, [data-auto-scaling], [data-marp-fitting]");t.setAttribute(`${a}load`,e?"":"hideable")}}))},P=({interval:e=250}={})=>t=>{document.addEventListener("keydown",(e=>{if(" "===e.key&&e.shiftKey)t.prev();else if("ArrowLeft"===e.key||"ArrowUp"===e.key||"PageUp"===e.key)t.prev({fragment:!e.shiftKey});else if(" "!==e.key||e.shiftKey)if("ArrowRight"===e.key||"ArrowDown"===e.key||"PageDown"===e.key)t.next({fragment:!e.shiftKey});else if("End"===e.key)t.slide(t.slides.length-1,{fragment:-1});else{if("Home"!==e.key)return;t.slide(0)}else t.next();e.preventDefault()}));let n,r,o=0;t.parent.addEventListener("wheel",(i=>{let a=!1;const s=(e,t)=>{e&&(a=a||((e,t)=>((e,t)=>{const n="X"===t?"Width":"Height";return e[`client${n}`]<e[`scroll${n}`]})(e,t)&&((e,t)=>{const{overflow:n}=e,r=e[`overflow${t}`];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r})(getComputedStyle(e),t))(e,t)),(null==e?void 0:e.parentElement)&&s(e.parentElement,t)};if(0!==i.deltaX&&s(i.target,"X"),0!==i.deltaY&&s(i.target,"Y"),a)return;i.preventDefault();const l=Math.sqrt(i.deltaX**2+i.deltaY**2);if(void 0!==i.wheelDelta){if(void 0===i.webkitForce&&Math.abs(i.wheelDelta)<40)return;if(i.deltaMode===i.DOM_DELTA_PIXEL&&l<4)return}else if(i.deltaMode===i.DOM_DELTA_PIXEL&&l<12)return;r&&clearTimeout(r),r=setTimeout((()=>{n=0}),e);const d=Date.now()-o<e,c=l<=n;if(n=l,d||c)return;let u;(i.deltaX>0||i.deltaY>0)&&(u="next"),(i.deltaX<0||i.deltaY<0)&&(u="prev"),u&&(t[u](),o=Date.now())}))},T=(e=`.${i}osc`)=>{const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[${a}osc=${JSON.stringify(e)}]`).forEach(n)};return b()||n("fullscreen",(e=>e.style.display="none")),u||n("presenter",(e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."})),e=>{t.addEventListener("click",(t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;n&&t.target.blur();const r={fragment:!t.shiftKey};"next"===n?e.next(r):"prev"===n?e.prev(r):"fullscreen"===n?null==e||e.fullscreen():"presenter"===n&&e.openPresenterView()}})),e.parent.appendChild(t),e.on("activate",(({index:t})=>{n("page",(n=>n.textContent=`Page ${t+1} of ${e.slides.length}`))})),e.on("fragment",(({index:t,fragments:r,fragmentIndex:o})=>{n("prev",(e=>e.disabled=0===t&&0===o)),n("next",(n=>n.disabled=t===e.slides.length-1&&o===r.length-1))})),e.on("marp-active",(()=>p(t,!1))),e.on("marp-inactive",(()=>p(t,!0))),b()&&(e=>{for(const t of["","webkit"])y.addEventListener(t+"fullscreenchange",e)})((()=>n("fullscreen",(e=>e.classList.toggle("exit",b()&&w())))))}},_=e=>{window.addEventListener("message",(t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let o=Number.parseInt(t,10),i=Number.parseInt(n,10)+1;i>=e.fragments[o].length&&(o+=1,i=0),e.slide(o,{fragment:i})}}))};var I=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];let M=e=>String(e).replace(/[&<>"']/g,(e=>`&${A[e]};`)),A={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},D="dangerouslySetInnerHTML",O={className:"class",htmlFor:"for"},C={};function N(e,t){let n=[],r="";t=t||{};for(let e=arguments.length;e-- >2;)n.push(arguments[e]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(let e in t)!1!==t[e]&&null!=t[e]&&e!==D&&(r+=` ${O[e]?O[e]:M(e)}="${M(t[e])}"`);r+=">"}if(-1===I.indexOf(e)){if(t[D])r+=t[D].__html;else for(;n.length;){let e=n.pop();if(e)if(e.pop)for(let t=e.length;t--;)n.push(e[t]);else r+=!0===C[e]?e:M(e)}r+=e?`</${e}>`:""}return C[r]=!0,r}const B=({children:e})=>N(null,null,...e),q=`${i}presenter-`,K={container:`${q}container`,dragbar:`${q}dragbar-container`,next:`${q}next`,nextContainer:`${q}next-container`,noteContainer:`${q}note-container`,noteWrapper:`${q}note-wrapper`,noteButtons:`${q}note-buttons`,infoContainer:`${q}info-container`,infoPage:`${q}info-page`,infoPageText:`${q}info-page-text`,infoPagePrev:`${q}info-page-prev`,infoPageNext:`${q}info-page-next`,noteButtonsBigger:`${q}note-bigger`,noteButtonsSmaller:`${q}note-smaller`,infoTime:`${q}info-time`,infoTimer:`${q}info-timer`},F=e=>{const{title:t}=document;document.title="[Presenter view]"+(t?` - ${t}`:"");const n={},r=e=>(n[e]=n[e]||document.querySelector(`.${e}`),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=K.container,t.appendChild(e),t.insertAdjacentHTML("beforeend",N(B,null,N("div",{class:K.nextContainer},N("iframe",{class:K.next,src:"?view=next"})),N("div",{class:K.dragbar}),N("div",{class:K.noteContainer},N("div",{class:K.noteWrapper}),N("div",{class:K.noteButtons},N("button",{class:K.noteButtonsSmaller,tabindex:"-1",title:"Smaller notes font size"},"Smaller notes font size"),N("button",{class:K.noteButtonsBigger,tabindex:"-1",title:"Bigger notes font size"},"Bigger notes font size"))),N("div",{class:K.infoContainer},N("div",{class:K.infoPage},N("button",{class:K.infoPagePrev,tabindex:"-1",title:"Previous"},"Previous"),N("span",{class:K.infoPageText}),N("button",{class:K.infoPageNext,tabindex:"-1",title:"Next"},"Next")),N("time",{class:K.infoTime,title:"Current time"}),N("time",{class:K.infoTimer,title:"Timer"})))),t})(e.parent)),(e=>{let t=!1;r(K.dragbar).addEventListener("mousedown",(()=>{t=!0,r(K.dragbar).classList.add("active")})),window.addEventListener("mouseup",(()=>{t=!1,r(K.dragbar).classList.remove("active")})),window.addEventListener("mousemove",(e=>{if(!t)return;const n=e.clientX/document.documentElement.clientWidth*100;r(K.container).style.setProperty("--bespoke-marp-presenter-split-ratio",`${Math.max(0,Math.min(100,n))}%`)})),r(K.nextContainer).addEventListener("click",(()=>e.next()));const n=r(K.next),o=(i=n,(e,t)=>{var n;return null===(n=i.contentWindow)||void 0===n?void 0:n.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin)});var i;n.addEventListener("load",(()=>{r(K.nextContainer).classList.add("active"),o(e.slide(),e.fragmentIndex),e.on("fragment",(({index:e,fragmentIndex:t})=>o(e,t)))}));const a=document.querySelectorAll(".bespoke-marp-note");a.forEach((e=>{e.addEventListener("keydown",(e=>e.stopPropagation())),r(K.noteWrapper).appendChild(e)})),e.on("activate",(()=>a.forEach((t=>t.classList.toggle("active",t.dataset.index==e.slide())))));let s=0;const l=e=>{s=Math.max(-5,s+e),r(K.noteContainer).style.setProperty("--bespoke-marp-note-font-scale",(1.2**s).toFixed(4))},d=()=>l(1),c=()=>l(-1),u=r(K.noteButtonsBigger),f=r(K.noteButtonsSmaller);u.addEventListener("click",(()=>{u.blur(),d()})),f.addEventListener("click",(()=>{f.blur(),c()})),document.addEventListener("keydown",(e=>{"+"===e.key&&d(),"-"===e.key&&c()}),!0),e.on("activate",(({index:t})=>{r(K.infoPageText).textContent=`${t+1} / ${e.slides.length}`}));const m=r(K.infoPagePrev),g=r(K.infoPageNext);m.addEventListener("click",(t=>{m.blur(),e.prev({fragment:!t.shiftKey})})),g.addEventListener("click",(t=>{g.blur(),e.next({fragment:!t.shiftKey})})),e.on("fragment",(({index:t,fragments:n,fragmentIndex:r})=>{m.disabled=0===t&&0===r,g.disabled=t===e.slides.length-1&&r===n.length-1}));let p=new Date;const v=()=>{const e=new Date,t=e=>`${Math.floor(e)}`.padStart(2,"0"),n=e.getTime()-p.getTime(),o=t(n/1e3%60),i=t(n/1e3/60%60),a=t(n/36e5%24);r(K.infoTime).textContent=e.toLocaleTimeString(),r(K.infoTimer).textContent=`${a}:${i}:${o}`};v(),setInterval(v,250),r(K.infoTimer).addEventListener("click",(()=>{p=new Date}))})(e)},j=e=>{if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:V},presenterUrl:{enumerable:!0,get:U}}),u&&document.addEventListener("keydown",(t=>{"p"!==t.key||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())}))};function V(){const{max:e,floor:t}=Math,n=e(t(.85*window.innerWidth),640),r=e(t(.85*window.innerHeight),360);return window.open(this.presenterUrl,q+this.syncKey,`width=${n},height=${r},menubar=no,toolbar=no`)}function U(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),s(e)}const X=e=>{const t=l();return t===r&&e.appendChild(document.createElement("span")),{"":j,[n]:F,[r]:_}[t]},H=e=>{e.on("activate",(t=>{document.querySelectorAll(".bespoke-progress-parent > .bespoke-progress-bar").forEach((n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"}))}))},R=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t},W=(e={})=>{const t={history:!0,...e};return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},o=(t={fragment:!0})=>{((t,n)=>{const{min:r,max:o}=Math,{fragments:i,slides:a}=e,s=o(0,r(t,a.length-1)),l=o(0,r(n||0,i[s].length-1));s===e.slide()&&l===e.fragmentIndex||e.slide(s,{fragment:l})})((R(location.hash.slice(1))||1)-1,t.fragment?R(d("f")||""):null)};e.on("fragment",(({index:e,fragmentIndex:r})=>{n||c({f:0===r||r.toString()},{location:{...location,hash:`#${e+1}`},setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})})),setTimeout((()=>{o(),window.addEventListener("hashchange",(()=>r((()=>{o({fragment:!1}),c({f:void 0})})))),window.addEventListener("popstate",(()=>{n||r((()=>o()))})),n=!1}),0)}},J=(e={})=>{var n;const r=e.key||(null===(n=window.history.state)||void 0===n?void 0:n.marpBespokeSyncKey)||Math.random().toString(36).slice(2),o=`bespoke-marp-sync-${r}`;var i;i={marpBespokeSyncKey:r},c({},{setter:(e,...n)=>t({...e,...i},...n)});const a=()=>{const e=f(o);return e?JSON.parse(e):Object.create(null)},s=e=>{const t=a(),n={...t,...e(t)};return m(o,JSON.stringify(n)),n},l=()=>{window.removeEventListener("pageshow",l),s((e=>({reference:(e.reference||0)+1})))};return e=>{l(),Object.defineProperty(e,"syncKey",{value:r,enumerable:!0});let t=!0;setTimeout((()=>{e.on("fragment",(e=>{t&&s((()=>({index:e.index,fragmentIndex:e.fragmentIndex})))}))}),0),window.addEventListener("storage",(n=>{if(n.key===o&&n.oldValue&&n.newValue){const r=JSON.parse(n.oldValue),o=JSON.parse(n.newValue);if(r.index!==o.index||r.fragmentIndex!==o.fragmentIndex)try{t=!1,e.slide(o.index,{fragment:o.fragmentIndex,forSync:!0})}finally{t=!0}}}));const n=()=>{const{reference:e}=a();void 0===e||e<=1?g(o):s((()=>({reference:e-1})))};window.addEventListener("pagehide",(e=>{e.persisted&&window.addEventListener("pageshow",l),n()})),e.on("destroy",n)}},{PI:Y,abs:z,sqrt:G,atan2:Q}=Math,Z={passive:!0},ee=({slope:e=-.7,swipeThreshold:t=30}={})=>n=>{let r;const o=n.parent,i=e=>{const t=o.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};o.addEventListener("touchstart",(({touches:e})=>{r=1===e.length?i(e[0]):void 0}),Z),o.addEventListener("touchmove",(e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=i(e.touches[0]),n=t.x-r.x,o=t.y-r.y;r.delta=G(z(n)**2+z(o)**2),r.radian=Q(n,o)}else r=void 0})),o.addEventListener("touchend",(o=>{if(r){if(r.delta&&r.delta>=t&&r.radian){const t=(r.radian-e+Y)%(2*Y)-Y;n[t<0?"next":"prev"](),o.stopPropagation()}r=void 0}}),Z)},te=new Map;te.clear(),te.set("none",{backward:{both:void 0,incoming:void 0,outgoing:void 0},forward:{both:void 0,incoming:void 0,outgoing:void 0}});const ne={both:"",outgoing:"outgoing-",incoming:"incoming-"},re={forward:"",backward:"-backward"},oe=e=>`--marp-bespoke-transition-animation-${e}`,ie=e=>`--marp-transition-${e}`,ae=oe("name"),se=oe("duration"),le=e=>new Promise((t=>{const n={},r=document.createElement("div"),o=e=>{r.remove(),t(e)};r.addEventListener("animationstart",(()=>o(n))),Object.assign(r.style,{animationName:e,animationDuration:"1s",animationFillMode:"both",animationPlayState:"paused",position:"absolute",pointerEvents:"none"}),document.body.appendChild(r);const i=getComputedStyle(r).getPropertyValue(ie("duration"));i&&(n.defaultDuration=i),((e,t)=>{requestAnimationFrame((()=>{e.style.animationPlayState="running",requestAnimationFrame((()=>t(void 0)))}))})(r,o)})),de=async e=>te.has(e)?te.get(e):(e=>{const t={},n=[];for(const[r,o]of Object.entries(ne))for(const[i,a]of Object.entries(re)){const s=`marp-${o}transition${a}-${e}`;n.push(le(s).then((e=>{t[i]=t[i]||{},t[i][r]=e?{...e,name:s}:void 0})))}return Promise.all(n).then((()=>t))})(e).then((t=>(te.set(e,t),t))),ce=e=>Object.values(e).flatMap(Object.values).every((e=>!e)),ue=(e,{type:t,backward:n})=>{const r=e[n?"backward":"forward"],o=(()=>{const e=r[t],n=e=>({[ae]:e.name});if(e)return n(e);if(r.both){const e=n(r.both);return"incoming"===t&&(e[oe("direction")]="reverse"),e}})();return!o&&n?ue(e,{type:t,backward:!1}):o||{[ae]:"__bespoke_marp_transition_no_animation__"}},fe=e=>{if(e)try{const t=JSON.parse(e);if((e=>{if("object"!=typeof e)return!1;const t=e;return"string"==typeof t.name&&(void 0===t.duration||"string"==typeof t.duration)})(t))return t}catch(e){}},me="_tSId",ge="_tA",pe="bespoke-marp-transition-warming-up",ve=window.matchMedia("(prefers-reduced-motion: reduce)"),he="__bespoke_marp_transition_reduced_outgoing__",ye="__bespoke_marp_transition_reduced_incoming__",be={forward:{both:void 0,incoming:{name:ye},outgoing:{name:he}},backward:{both:void 0,incoming:{name:ye},outgoing:{name:he}}},we=e=>{if(!document.startViewTransition)return;const t=t=>(void 0!==t&&(e._tD=t),e._tD);let n;t(!1),((...e)=>{const t=[...new Set(e).values()];return Promise.all(t.map((e=>de(e)))).then()})(...Array.from(document.querySelectorAll("section[data-transition], section[data-transition-back]")).flatMap((e=>[e.dataset.transition,e.dataset.transitionBack].flatMap((e=>{const t=fe(e);return[null==t?void 0:t.name,(null==t?void 0:t.builtinFallback)?`__builtin__${t.name}`:void 0]})).filter((e=>!!e))))).then((()=>{document.querySelectorAll("style").forEach((e=>{e.innerHTML=e.innerHTML.replace(/--marp-transition-duration:[^;}]*[;}]/g,(e=>e.slice(0,-1)+"!important"+e.slice(-1)))}))}));const r=(n,{back:r,cond:o})=>i=>{var a;const s=t();if(s)return!!i[ge]||!("object"!=typeof s||(s.skipTransition(),!i.forSync));if(!o(i))return!0;const l=e.slides[e.slide()],d=()=>{var e;return null!==(e=i.back)&&void 0!==e?e:r},c="data-transition"+(d()?"-back":""),u=l.querySelector(`section[${c}]`);if(!u)return!0;const f=fe(null!==(a=u.getAttribute(c))&&void 0!==a?a:void 0);return!f||((async(e,{builtinFallback:t=!0}={})=>{let n=await de(e);if(ce(n)){if(!t)return;return n=await de(`__builtin__${e}`),ce(n)?void 0:n}return n})(f.name,{builtinFallback:f.builtinFallback}).then((e=>{if(!e){t(!0);try{n(i)}finally{t(!1)}return}let r=e;ve.matches&&(console.warn("Use a constant animation to transition because preferring reduced motion by viewer has detected."),r=be);const o=document.getElementById(me);o&&o.remove();const a=document.createElement("style");a.id=me,document.head.appendChild(a),((e,t)=>{const n=[`:root{${ie("direction")}:${t.backward?-1:1};}`],r=t=>{var n,o,i;const a=(null===(n=e[t].both)||void 0===n?void 0:n.defaultDuration)||(null===(o=e[t].outgoing)||void 0===o?void 0:o.defaultDuration)||(null===(i=e[t].incoming)||void 0===i?void 0:i.defaultDuration);return"forward"===t?a:a||r("forward")},o=t.duration||r(t.backward?"backward":"forward");void 0!==o&&n.push(`::view-transition-group(*){${se}:${o};}`);const i=e=>Object.entries(e).map((([e,t])=>`${e}:${t};`)).join("");return n.push(`::view-transition-old(root){${i(ue(e,{...t,type:"outgoing"}))}}`,`::view-transition-new(root){${i(ue(e,{...t,type:"incoming"}))}}`),n})(r,{backward:d(),duration:f.duration}).forEach((e=>{var t;return null===(t=a.sheet)||void 0===t?void 0:t.insertRule(e)}));const s=document.documentElement.classList;s.add(pe);let l=!1;const c=()=>{l||(n(i),l=!0,s.remove(pe))},u=()=>{t(!1),a.remove(),s.remove(pe)};try{t(!0);const e=document.startViewTransition(c);t(e),e.finished.finally(u)}catch(e){console.error(e),c(),u()}})),!1)};e.on("prev",r((t=>e.prev({...t,[ge]:!0})),{back:!0,cond:e=>{var t;return e.index>0&&!((null===(t=e.fragment)||void 0===t||t)&&n.fragmentIndex>0)}})),e.on("next",r((t=>e.next({...t,[ge]:!0})),{cond:t=>t.index+1<e.slides.length&&!(n.fragmentIndex+1<n.fragments.length)})),setTimeout((()=>{e.on("slide",r((t=>e.slide(t.index,{...t,[ge]:!0})),{cond:t=>{const n=e.slide();return t.index!==n&&(t.back=t.index<n,!0)}}))}),0),e.on("fragment",(e=>{n=e}))};let xe;const ke=()=>(void 0===xe&&(xe="wakeLock"in navigator&&navigator.wakeLock),xe),$e=async()=>{const e=ke();if(e)try{return await e.request("screen")}catch(e){console.warn(e)}return null},Ee=async()=>{if(!ke())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&$e()};for(const e of["visibilitychange","fullscreenchange"])document.addEventListener(e,t);return e=await $e(),e};((t=document.getElementById("p"))=>{(()=>{const t=d("view");e.dataset.bespokeView=t===r||t===n?t:""})();const i=(e=>{const t=d(e);return c({[e]:void 0}),t})("sync")||void 0;var a,s,u,f,m,g,p,y,b,w,k,E;a=t,s=((...e)=>{const t=o.findIndex((e=>l()===e));return e.map((([e,n])=>e[t]&&n)).filter((e=>e))})([[1,1,0],J({key:i})],[[1,1,1],X(t)],[[1,1,0],L],[[1,1,1],v],[[1,0,0],$()],[[1,1,1],S],[[1,1,1],W({history:!1})],[[1,1,0],P()],[[1,1,0],x],[[1,0,0],H],[[1,1,0],ee()],[[1,0,0],T()],[[1,0,0],we],[[1,1,1],h],[[1,1,0],Ee]),f=1===(a.parent||a).nodeType?a.parent||a:document.querySelector(a.parent||a),m=[].filter.call("string"==typeof a.slides?f.querySelectorAll(a.slides):a.slides||f.children,(function(e){return"SCRIPT"!==e.nodeName})),g={},p=function(e,t){return(t=t||{}).index=m.indexOf(e),t.slide=e,t},w=function(e,t){m[e]&&(u&&b("deactivate",p(u,t)),u=m[e],b("activate",p(u,t)))},k=function(e,t){var n=m.indexOf(u)+e;b(e>0?"next":"prev",p(u,t))&&w(n,t)},E={off:y=function(e,t){g[e]=(g[e]||[]).filter((function(e){return e!==t}))},on:function(e,t){return(g[e]||(g[e]=[])).push(t),y.bind(null,e,t)},fire:b=function(e,t){return(g[e]||[]).reduce((function(e,n){return e&&!1!==n(t)}),!0)},slide:function(e,t){if(!arguments.length)return m.indexOf(u);b("slide",p(m[e],t))&&w(e,t)},next:k.bind(null,1),prev:k.bind(null,-1),parent:f,slides:m,destroy:function(e){b("destroy",p(u,e)),g={}}},(s||[]).forEach((function(e){e(E)})),u||w(0)})()}();</script></body></html>